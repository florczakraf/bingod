<html>

<head>
    <meta charset="UTF-8">
    <style>
        body {
            background-color: powderblue;
            text-align: center;
            color: black;
        }

        h1 {
            font-size: 80px;
        }

        h2 {
            font-size: 65px;
        }

        table {
            border: 1px solid black;
        }

        td {
            border: 1px solid black;
            width: 200px;
            height: 200px;
        }

        .bingo-field {
            width: 150px;
            height: 150px;
            border: 1px solid black;
            margin-right: 5px;
            margin-bottom: 5px;
            padding: 5px;
        }

        #bingo-container {
            display: flex;
            /* flex-wrap: wrap; */
        }
    </style>
    <script>

        class Board {
            constructor(goals, size) {
                this.size = size;
                this.goals = getRandomSubarray(goals, size * size);
                this.goals.forEach((g) => {
                    g.count = 0;
                    g.target = g.target || 1;
                    g.increase = (() => { g.count = Math.min(++g.count, g.target); this.redraw(); }).bind({"this": this, "g": g});
                    g.decrease = (() => { g.count = Math.max(0, --g.count); this.redraw() }).bind({"this": this, "g": g});
                    g.met = (() => { return g.count == g.target; }).bind({"this": this, "g": g});
                    g.is_multitarget = (() => { return g.target > 1; }).bind({"this": this, "g": g});
                });
                this._generate_board();
            }

            _generate_board() {
                let container = document.getElementById("bingo-container");
                for (let i = 0; i < this.size; i++) {
                    let row = document.createElement("div");
                    for (let j = 0; j < this.size; j++) {
                        let field = document.createElement("div");
                        let field_id = i * this.size + j;
                        field.id = "b" + field_id;
                        field.classList.add("bingo-field");
                        field.addEventListener('click', (() => { this.goals[field_id].increase() }).bind(this), false);
                        row.appendChild(field);
                    }
                    container.appendChild(row);
                }
                this.redraw();
            }

            redraw()
            {
                this.goals.forEach((goal, i) => {
                    let field = document.getElementById("b" + i);
                    let label = goal.name;

                    if (goal.is_multitarget()) {
                        label += " (" + goal.count + "/" + goal.target + ")";
                    }

                    if (goal.met()) {
                        field.style.backgroundColor = "green";
                    }
                    field.innerText = label;
                })
            }
        }

        polska_hiszpania = [
            { name: '4 kartki dla Polski', target: 4 },
            { name: 'karny' },
            { name: 'kontuzja' },
            { name: 'remis po pierwszej połowie' },
            { name: 'rożny przed 15 minutą' },
            { name: '9 rożnych', target: 9 },
            { name: 'zbliżenie na Lewego' },
            { name: 'Szwecja 60%+ posiadania w pierwszej połowie' },
            { name: 'Polska przepierdala do zera' },
            { name: 'gol honorowy dla Polaków' },
            { name: 'czerwona kartka' },
            { name: 'samobój' },
            { name: '3 kartki dla Szwedów', target: 3 },
            { name: '5 celnych strzałów', target: 5 },
            { name: 'VAR' },
            { name: '80 celnych podań dla Polaków w pierwszej połowie' },
            { name: '2 poprzeczki', target: 2 },
            { name: '4+ doliczone minuty w drugiej połowie' },
            { name: '9 outów dla Polaków', target: 9 },
            { name: 'Szczęsny schodzi' },
            { name: 'spalony' },
            { name: 'laga -> Robercik' },
            { name: '10 x "okazja"' }
        ];

        function getRandomSubarray(arr, size) {
            let shuffled = arr.slice(0);
            let i = arr.length;
            let temp;
            let index;
            while (i--) {
                index = Math.floor((i + 1) * Math.random());
                temp = shuffled[index];
                shuffled[index] = shuffled[i];
                shuffled[i] = temp;
            }
            return shuffled.slice(0, size);
        }
    </script>
</head>

<body>
    <h1>bingo</h1>
    <div id="bingo-container"></div>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            board = new Board(polska_hiszpania, 4);
        }, false);
    </script>
</body>

</html>
